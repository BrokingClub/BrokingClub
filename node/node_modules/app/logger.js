var fs = require('fs');
var morgan = require('morgan');
var moment = require('moment');
var stream = fs.createWriteStream('server.log', { flags: 'a' });
var format = ':method :url :status - :res[content-length] bytes - :response-time ms';
var _console = {
    log: console.log,
    error: console.error
};

console.log = function(data){
    _console.log(data);
    write(data + '\r');
};

console.error = function(data){
    _console.error(data);
    write(data + '\r');
};

module.exports = morgan(format, {
    stream: {
        write: write   
    }
});

function write(message, encoding){
    var time = moment().format('DD. MMM YYYY / HH:mm:ss.SSS');

    stream.write(time + ' - ' + message, encoding);
};